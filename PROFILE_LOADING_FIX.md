# ЁЯЪи Profile ржкрзЗржЬ рж▓рзЛржбрж┐ржВ рж╕ржорж╕рзНржпрж╛рж░ рж╕ржорзНржкрзВрж░рзНржг рж╕ржорж╛ржзрж╛ржи

## тЭМ рж╕ржорж╕рзНржпрж╛
- Profile ржкрзЗржЬ рж╢рзБржзрзБ рж▓рзЛржбрж┐ржВ ржжрзЗржЦрж╛ржЪрзНржЫрзЗ
- Fatal Error: `user_profiles` ржЯрзЗржмрж┐рж▓ ржкрж╛ржУржпрж╝рж╛ ржпрж╛ржЪрзНржЫрзЗ ржирж╛
- ржкрзЗржЬ crash рж╣ржЪрзНржЫрзЗ

## тЬЕ ржжрзНрж░рзБржд рж╕ржорж╛ржзрж╛ржи

### ЁЯФз ржзрж╛ржк рзз: ржбрж╛ржпрж╝рж╛ржЧржирж╕рзНржЯрж┐ржХ ржЯрзБрж▓ ржЪрж╛рж▓рж╛ржи
```
http://localhost/fishcare/profile_diagnostic.php
```

### ЁЯФз ржзрж╛ржк рзи: ржПржХ ржХрзНрж▓рж┐ржХрзЗ ржлрж┐ржХрзНрж╕
1. ржбрж╛ржпрж╝рж╛ржЧржирж╕рзНржЯрж┐ржХ ржкрзЗржЬрзЗ ржпрж╛ржи
2. **"ЁЯФз ржбрзЗржЯрж╛ржмрзЗрж╕ ржлрж┐ржХрзНрж╕ ржХрж░рзБржи"** ржмрж╛ржЯржи ржХрзНрж▓рж┐ржХ ржХрж░рзБржи
3. ржЕржкрзЗржХрзНрж╖рж╛ ржХрж░рзБржи (рзи-рзй рж╕рзЗржХрзЗржирзНржб)

### ЁЯФз ржзрж╛ржк рзй: ржЯрзЗрж╕рзНржЯ ржХрж░рзБржи
```
http://localhost/fishcare/pages/dashboard/farmer/profile.php
```

---

## ЁЯЫая╕П ржмрж┐ржХрж▓рзНржк рж╕ржорж╛ржзрж╛ржи

### ржЕржкрж╢ржи рзз: SQL рж╕рзНржХрзНрж░рж┐ржкрзНржЯ ржЪрж╛рж▓рж╛ржи
MySQL-ржП ржПржЗ ржХржорж╛ржирзНржб рж░рж╛ржи ржХрж░рзБржи:

```sql
-- ржбрзЗржЯрж╛ржмрзЗрж╕ ржмрзНржпржмрж╣рж╛рж░
USE fishcare;

-- ржЯрзЗржмрж┐рж▓ рждрзИрж░рж┐ ржХрж░рзБржи
CREATE TABLE IF NOT EXISTS user_profiles (
    id INT AUTO_INCREMENT PRIMARY KEY,
    user_id INT NOT NULL UNIQUE,
    profile_image VARCHAR(500),
    farming_experience INT DEFAULT 0,
    pond_count INT DEFAULT 0,
    farming_type ENUM('traditional', 'modern', 'semi_modern') DEFAULT 'traditional',
    preferred_fish_species TEXT DEFAULT '',
    annual_income DECIMAL(12,2) DEFAULT 0.00,
    bio TEXT DEFAULT '',
    notification_preferences JSON,
    privacy_settings JSON,
    last_login TIMESTAMP,
    profile_completion_percentage INT DEFAULT 0,
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
    INDEX idx_user (user_id)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;

-- ржЗржЙржЬрж╛рж░ржжрзЗрж░ ржЬржирзНржп ржбрж┐ржлрж▓рзНржЯ ржкрзНрж░рзЛржлрж╛ржЗрж▓ рждрзИрж░рж┐ ржХрж░рзБржи
INSERT INTO user_profiles (user_id, farming_experience, pond_count, farming_type, preferred_fish_species, annual_income, bio)
SELECT 
    u.id,
    3,
    2,
    'traditional',
    'рж░рзБржЗ,рждрзЗрж▓рж╛ржкрж┐ржпрж╝рж╛',
    200000.00,
    'ржирждрзБржи ржмрзНржпржмрж╣рж╛рж░ржХрж╛рж░рзА'
FROM users u
LEFT JOIN user_profiles up ON u.id = up.user_id
WHERE up.user_id IS NULL
ON DUPLICATE KEY UPDATE
    farming_experience = VALUES(farming_experience),
    pond_count = VALUES(pond_count);
```

### ржЕржкрж╢ржи рзи: PHP ржлрж┐ржХрзНрж╕ рж╕рзНржХрзНрж░рж┐ржкрзНржЯ
ржмрзНрж░рж╛ржЙржЬрж╛рж░рзЗ ржПржЗ ржкрзЗржЬ ржЦрзБрж▓рзБржи:
```
http://localhost/fishcare/fix_profile_database.php
```

### ржЕржкрж╢ржи рзй: phpMyAdmin
1. phpMyAdmin ржЦрзБрж▓рзБржи
2. `fishcare` ржбрзЗржЯрж╛ржмрзЗрж╕ рж╕рж┐рж▓рзЗржХрзНржЯ ржХрж░рзБржи
3. SQL ржЯрзНржпрж╛ржмрзЗ ржЧрж┐ржпрж╝рзЗ ржЙржкрж░рзЗрж░ SQL ржХрзЛржб рж░рж╛ржи ржХрж░рзБржи

---

## ЁЯФН ржХрж┐ рж╣ржЪрзНржЫрзЗ ржПржЦрж╛ржирзЗ?

### рж╕ржорж╕рзНржпрж╛:
- `user_profiles` ржЯрзЗржмрж┐рж▓ ржбрзЗржЯрж╛ржмрзЗрж╕рзЗ ржирзЗржЗ
- PHP ржХрзЛржб ржЯрзЗржмрж┐рж▓ ржЦрзБржБржЬрждрзЗ ржЧрж┐ржпрж╝рзЗ ржПрж░рж░ ржжрж┐ржЪрзНржЫрзЗ
- ржкрзЗржЬ crash рж╣ржЪрзНржЫрзЗ

### рж╕ржорж╛ржзрж╛ржи:
- `user_profiles` ржЯрзЗржмрж┐рж▓ рждрзИрж░рж┐ ржХрж░рж╛
- ржЗржЙржЬрж╛рж░ржжрзЗрж░ ржЬржирзНржп ржбрж┐ржлрж▓рзНржЯ ржкрзНрж░рзЛржлрж╛ржЗрж▓ ржмрж╛ржирж╛ржирзЛ
- Error handling ржпрзЛржЧ ржХрж░рж╛

---

## ЁЯУБ рждрзИрж░рж┐ рж╣ржУржпрж╝рж╛ ржлрж╛ржЗрж▓рж╕ржорзВрж╣:

1. **`profile_diagnostic.php`** - рж╕ржорж╕рзНржпрж╛ ржЪрж┐рж╣рзНржирж┐рждржХрж░ржг ржЯрзБрж▓
2. **`fix_database_ajax.php`** - AJAX ржлрж┐ржХрзНрж╕ ржЯрзБрж▓  
3. **`fix_profile_database.php`** - ржПржХрзНрж╕ржкрзНрж░рзЗрж╕ ржлрж┐ржХрзНрж╕ рж╕рзНржХрзНрж░рж┐ржкрзНржЯ
4. **`profile_safe.php`** - ржирж┐рж░рж╛ржкржж Profile ржкрзЗржЬ (backup)

---

## тЪб ржжрзНрж░рзБржд ржЪрзЗржХ ржХрж░рж╛рж░ ржХржорж╛ржирзНржб

### ржбрзЗржЯрж╛ржмрзЗрж╕рзЗ ржЯрзЗржмрж┐рж▓ ржЖржЫрзЗ ржХрж┐ржирж╛ ржЪрзЗржХ:
```sql
SHOW TABLES LIKE 'user_profiles';
```

### ржЗржЙржЬрж╛рж░ ржкрзНрж░рзЛржлрж╛ржЗрж▓ ржЧржгржирж╛:
```sql
SELECT COUNT(*) as profile_count FROM user_profiles;
```

### ржЪрж╛рж╖рзА ржЗржЙржЬрж╛рж░ ржЪрзЗржХ:
```sql
SELECT u.username, u.full_name, up.farming_experience 
FROM users u 
LEFT JOIN user_profiles up ON u.id = up.user_id 
WHERE u.role = 'farmer' 
LIMIT 3;
```

---

## ЁЯОп рж╕ржлрж▓рждрж╛рж░ ржЪрж┐рж╣рзНржи

тЬЕ ржбрж╛ржпрж╝рж╛ржЧржирж╕рзНржЯрж┐ржХ ржкрзЗржЬрзЗ рж╕ржмрзБржЬ ржЧрзНржпрж╛ржЮрзНржЬ  
тЬЕ Profile ржкрзЗржЬ рж╕ржлрж▓ржнрж╛ржмрзЗ рж▓рзЛржб рж╣ржЪрзНржЫрзЗ  
тЬЕ ржХрзЛржирзЛ Fatal Error ржирзЗржЗ  
тЬЕ рж╕ржм ржлрж░рзНржо ржХрж╛ржЬ ржХрж░ржЫрзЗ  

## ЁЯЖШ рж╕ржорж╕рзНржпрж╛ ржерж╛ржХрж▓рзЗ

ржпржжрж┐ ржПржЦржиржУ рж╕ржорж╕рзНржпрж╛ ржерж╛ржХрзЗ:

1. **ржбрзЗржЯрж╛ржмрзЗрж╕ ржХржиржлрж┐ржЧ ржЪрзЗржХ ржХрж░рзБржи:**
   - `config/database.php` ржлрж╛ржЗрж▓ ржЪрзЗржХ ржХрж░рзБржи
   - Database credentials рж╕ржарж┐ржХ ржЖржЫрзЗ ржХрж┐ржирж╛

2. **PHP рж╕рж╛рж░рзНржнрж╛рж░ рж░рж┐рж╕рзНржЯрж╛рж░рзНржЯ ржХрж░рзБржи**

3. **ржЕржирзНржп ржПржХржЯрж┐ ржмрзНрж░рж╛ржЙржЬрж╛рж░рзЗ ржЪрзЗрж╖рзНржЯрж╛ ржХрж░рзБржи**

4. **Cache clear ржХрж░рзБржи** (Ctrl+F5)

---

## ЁЯФз рж╕ржлрж▓ ржлрж┐ржХрзНрж╕рзЗрж░ ржкрж░

ржЖржкржирж╛рж░ Profile ржкрзЗржЬрзЗ ржПржЗ ржлрж┐ржЪрж╛рж░ржЧрзБрж▓рзЛ ржХрж╛ржЬ ржХрж░ржмрзЗ:

тЬЕ ржмрзНржпржХрзНрждрж┐ржЧржд рждржерзНржп ржПржбрж┐ржЯ  
тЬЕ ржЪрж╛рж╖ рж╕ржВржХрзНрж░рж╛ржирзНржд рждржерзНржп ржЖржкржбрзЗржЯ  
тЬЕ ржкрзНрж░рзЛржлрж╛ржЗрж▓ ржЫржмрж┐ ржЖржкрж▓рзЛржб  
тЬЕ ржкрж╛рж╕ржУржпрж╝рж╛рж░рзНржб ржкрж░рж┐ржмрж░рзНрждржи  
тЬЕ ржЧрзНрж▓рж╛рж╕ржорж░ржлрж┐ржЬржо ржбрж┐ржЬрж╛ржЗржи  
тЬЕ рж░рзЗрж╕ржкржирзНрж╕рж┐ржн ржЗржирзНржЯрж╛рж░ржлрзЗрж╕  

**ржЖржкржирж╛рж░ Fish Care рж╕рж┐рж╕рзНржЯрзЗржо ржПржЦржи рж╕ржорзНржкрзВрж░рзНржг ржкрзНрж░рж╕рзНрждрзБржд! ЁЯРЯЁЯТЪ**
